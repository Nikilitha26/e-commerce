<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Product Details</title>
  <!-- <link rel="stylesheet" href="../css/styles.css" /> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Satisfy&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
  :root {
    --gold: #d4a373;
    --gold-dark: #b97b56;
    --blush: #f7e9e3;
    --text-dark: #222;
    --text-soft: #555;
    --bg-light: #f4f1ee;
  }

body {
  background-color: #f4f1ee;
  color: #222;
  font-family: "Playfair Display", serif;
}

    /* Navbar */
    .navbar {
      border-bottom: 2px solid var(--gold);
    }

    .navbar-brand img {
      height: 60px;
      width: auto;
    }

    .nav-link {
      color: var(--text-dark);
    }

    .nav-link.active,
    .nav-link:hover {
      color: var(--gold-dark);
      font-weight: 600;
    }

    .profile-icon {
      font-size: 1.5rem;
      color: var(--text-dark);
    }

    .cart-count-badge {
    background-color: #d4a373;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
    position: relative;
    top: -10px;
    left: -5px;
  }

.cart-count-badge.bump {
  transform: scale(1.2);
}


/* product-details */
.product-wrapper {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  padding: 2rem;
  max-width: 1200px;
  margin: 140px auto 2rem auto;
  background-color: white;
  border-radius: 1rem;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

.swiper {
  width: 100%;
  max-width: 450px;
  height: auto;
  aspect-ratio: 4 / 3; /* maintains a consistent ratio */
  border-radius: 1rem;
  overflow: hidden;
  background-color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}

.swiper-slide img {
  width: 100%;
  height: 100%;
  object-fit: contain; 
  border-radius: 1rem;
  background-color: #f4f1ee;
}


.product-details {
  flex: 1;
  min-width: 300px;
  padding: 1rem;
}

.product-details h2 {
  font-size: 2rem;
  color: #b97b56;
  margin-bottom: 1rem;
}

.product-details p {
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
}

.btn-gold {
  background-color: #d4a373;
  color: white;
  border: none;
  margin-right: 1rem;
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  border-radius: 0.5rem;
  transition: background-color 0.3s ease;
}

.btn-gold:hover {
  background-color: #b97b56;
  color: white;
}

.btn-secondary {
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  border-radius: 0.5rem;
}

input[type="number"] {
  border-radius: 0.5rem;
  border: 1px solid #ccc;
  padding: 0.25rem 0.5rem;
}

/* similar items */
.section-title {
  position: relative;
  display: inline-block;
  font-size: 1.75rem;
  font-weight: bold;
  color: #b97b56;
  padding-bottom: 0.5rem;
  margin: 0 auto;
}

.section-title::after {
  content: "";
  display: block;
  width: 50%;
  height: 2px;
  background-color: #d4a373;
  margin: 0.5rem auto 0;
}


.similar-items .card {
  border: none;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
  transition: transform 0.2s;
  max-width: 350px;
  margin: auto;
}

.similar-items .card:hover {
  transform: translateY(-5px);
}

.similar-items img {
  height: 400px;
  max-width: 350px !important;
  object-fit: contain;
  border-bottom: 1px solid #eee;
}

.similar-items .card-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #222;
}

.similar-items .card-text {
  color: #555;
}

/* .similar-items {
  min-height: 400px; 
  padding: 3rem 1rem;
  background-color: #fff; 
  border-radius: 1rem;     
} */


    /* Footer */
    footer {
      background-color: white;
      border-top: 3px solid var(--gold);
      padding: 2rem 1rem;
      margin-top: 4rem;
    }

    footer p {
      text-align: center;
      margin: 0;
      color: var(--text-soft);
    }

  </style>
</head>
<body>

     <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top bg-white shadow-sm">
    <div class="container-fluid d-flex align-items-center">
  
      <!-- Logo on left -->
      <a class="navbar-brand" href="../index.html">
        <img src="https://nikilitha26.github.io/e-commerceHostedImages/niki_s__1_-removebg-preview.png" alt="Logo" style="height: 60px; width: 100px;">
      </a>
  
      <!-- Toggler for mobile -->
      <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
  
      <!-- Collapse content -->
      <div class="collapse navbar-collapse justify-content-center" id="mainNavbar">
        <!-- Wrapper to center nav links -->
        <div class="d-flex justify-content-center flex-grow-1">
          <ul class="navbar-nav gap-3" id="navLinks">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="./products.html">Products</a>
            </li>
            <li class="nav-item" id="adminNavItem">
              <a class="nav-link" href="./admin.html">Admin</a>
            </li>
            <li class="nav-item">
              <a href="./checkout.html" class="nav-link">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count" class="cart-count-badge">0</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./contact.html">Contacts</a>
            </li>
          </ul>
        </div>
  
        <!-- Profile icon on right -->
        <div class="nav-item dropdown" id="profileDropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" id="profileToggle">
            <i class="fas fa-user-circle profile-icon" style="font-size: 1.5rem;"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" id="profileMenu">
            <li><a class="dropdown-item" href="./login.html" id="loginLink">Login</a></li>
            <li><a class="dropdown-item" href="./register.html" id="registerLink">Register</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="./userdetails.html" id="profileLink">Profile</a></li>
            <li><a class="dropdown-item" href="./settings.html" id="settingsLink">Settings</a></li>
            <li><a class="dropdown-item" href="./orders.html" id="ordersLink">Orders</a></li>
            <li><a class="dropdown-item" href="./logout.html" id="logoutLink">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <div class="product-wrapper">
    <!-- Swiper Slider -->
    <div class="swiper">
      <div class="swiper-wrapper" id="swiper-images">
        <!-- Slides will be inserted here -->
      </div>
      <!-- Swiper Navigation -->
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-pagination"></div>
    </div>

    <!-- Product Details -->
    <div class="product-details" id="product-details">
      <h2 id="product-name"></h2>
      <p id="product-description"></p>
      <p id="product-price" style="font-weight: bold;"></p>
      <div class="quantity-selector d-flex align-items-center mb-3">
        <button class="btn btn-sm btn-outline-dark me-2" id="decrease-qty">âˆ’</button>
        <span id="quantity" class="px-3 fw-bold">1</span>
        <button class="btn btn-sm btn-outline-dark ms-2" id="increase-qty">+</button>
      </div>      
      
      <button class="btn btn-gold" id="add-to-cart" title="Add to Cart">
        <i class="fas fa-cart-plus"></i>
      </button>
      
      <button class="btn btn-secondary" onclick="history.back()">Return</button>
      
    </div>
  </div>
  
  <!-- You may also like -->
  <div class="similar-items w-100 mt-5 text-center">
    <h4 class="text-center mb-4 section-title">You may also like</h4>
    <div class="row justify-content-center" id="similar-items-container">
      <!-- Similar products will be inserted here -->
    </div>
  </div>  
  
    <!-- Footer -->
    <footer>
        <p>&copy; <span id="current-year"></span> Niki's Flex Fit. All rights reserved.</p>
      </footer>
    

  <!-- Scripts -->
  <script src="../script/navbar.js"></script>
  <script src="../script/checkout.js"></script>
  <script src="../script/product-detail.js"></script>
  <script src="../script/products.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById("current-year").textContent = new Date().getFullYear();

    document.addEventListener("DOMContentLoaded", () => {
      // Get product id from URL
      const urlParams = new URLSearchParams(window.location.search);
      const id = parseInt(urlParams.get("id"));

      if (!id) {
        console.error("Product ID missing in URL");
        return;
      }

      // Load items from localStorage
      const items = JSON.parse(localStorage.getItem("items")) || [];
      console.log("Loaded items from localStorage:", items);

      // Find product by id
      const product = items.find((item) => item.id === id);

      if (!product) {
        console.error("Product not found");
        return;
      }

      console.log("Product found:", product);

      // Elements to fill in
      const swiperWrapper = document.querySelector(".swiper-wrapper");
      const productName = document.getElementById("product-name");
      const productDescription = document.getElementById("product-description");
      const productPrice = document.getElementById("product-price");

      // Fill in product details
      productName.textContent = product.name;
      productDescription.textContent = product.description;
      productPrice.textContent = `R${product.price.toFixed(2)}`;

      // Clear existing slides (if any)
      swiperWrapper.innerHTML = "";
      console.log("Swiper wrapper cleared.");

      // Get images array
      const images = Array.isArray(product.image) ? product.image : [product.image];
      console.log("Images to display:", images);

      // Insert images as swiper slides
      images.forEach((imgUrl, index) => {
        const slide = document.createElement("div");
        slide.classList.add("swiper-slide");
        slide.innerHTML = `<img src="${imgUrl}" alt="${product.name} image ${index +
          1}" style="width: 100%;">`;
        swiperWrapper.appendChild(slide);
        console.log(`Added slide ${index + 1} with image URL: ${imgUrl}`);
      });

      // Initialize Swiper after slides are added
      const swiper = new Swiper(".swiper", {
        loop: true,
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
      });
      console.log("Swiper initialized.");

      document.querySelector(".btn-gold").addEventListener("click", () => {
  let cart = JSON.parse(localStorage.getItem("purchasedItems")) || [];
  const existing = cart.find(i => i.id === product.id);

  if (existing) {
    existing.quantity += 1;
  } else {
    cart.push({ ...product, quantity: 1 });
  }

  localStorage.setItem("purchasedItems", JSON.stringify(cart));
//   alert("Product added to cart!");
});

let quantity = 1;
const quantityDisplay = document.getElementById("quantity");

document.getElementById("increase-qty").addEventListener("click", () => {
  quantity++;
  quantityDisplay.textContent = quantity;
});

document.getElementById("decrease-qty").addEventListener("click", () => {
  if (quantity > 1) {
    quantity--;
    quantityDisplay.textContent = quantity;
  }
});


document.getElementById("add-to-cart").addEventListener("click", () => {
  // Login check
  const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
  if (!isLoggedIn) {
    Swal.fire({
      icon: 'warning',
      title: 'Login Required',
      text: 'Please login to add products to your cart.',
      confirmButtonColor: '#b97b56',
      background: '#fff',
      color: '#222'
    }).then(() => {
      window.location.href = "login.html";
    });
    return;
  }

  // Get existing cart or empty
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const existingItem = cart.find(item => item.id === product.id);

  if (existingItem) {
    existingItem.quantity += quantity;
  } else {
    cart.push({ ...product, quantity });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartCount();  // <-- Update badge here!

  Swal.fire({
    title: "Added to Cart!",
    text: `Added ${quantity} ${product.name}(s) to cart!`,
    icon: "success",
    timer: 2000,
    showConfirmButton: false,
    background: "#fff",
    color: "#222"
  });

  setTimeout(() => {
    window.location.href = "checkout.html";
  }, 1500);
});


// cart count
function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  let totalCount = 0;
  cart.forEach(item => {
    totalCount += item.quantity;
  });

  const cartCountElement = document.getElementById('cart-count');
  if (cartCountElement) {
    cartCountElement.textContent = totalCount;
  }
}

// Run on page load
updateCartCount();

// Run it on page load
// document.addEventListener('DOMContentLoaded', updateCartCount);


// similar items
// Find and render similar items
const similarContainer = document.getElementById("similar-items-container");

// Filter similar products (same category, not the same ID)
const similarItems = items.filter(item => item.category === product.category && item.id !== product.id).slice(0, 3);

// Render each
similarItems.forEach(item => {
  const col = document.createElement("div");
  col.className = "col-md-4 mb-4";

  col.innerHTML = `
    <div class="card h-100">
      <img src="${Array.isArray(item.image) ? item.image[0] : item.image}" class="card-img-top" alt="${item.name}">
      <div class="card-body">
        <h5 class="card-title">${item.name}</h5>
        <p class="card-text">R${item.price.toFixed(2)}</p>
        <a href="product-detail.html?id=${item.id}" class="btn btn-gold btn-sm">View</a>
      </div>
    </div>
  `;

  similarContainer.appendChild(col);
});


    });
  </script>
</body>
</html>
